{"openapi":"3.0.0","paths":{"/api/v1/auth/register":{"post":{"operationId":"AuthController_register","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterDto"}}}},"responses":{"201":{"description":"Usuario registrado exitosamente."},"409":{"description":"El correo ya existe."}},"summary":"Registro de nuevo usuario","tags":["Auth"]}},"/api/v1/auth/login":{"post":{"operationId":"AuthController_login","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginDto"}}}},"responses":{"200":{"description":"Login exitoso, retorna Access y Refresh Token."},"401":{"description":"Credenciales inválidas."}},"summary":"Inicio de sesión","tags":["Auth"]}},"/api/v1/auth/refresh":{"post":{"operationId":"AuthController_refresh","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefreshTokenDto"}}}},"responses":{"200":{"description":"Nuevo token generado."},"401":{"description":"Token inválido."}},"summary":"Refrescar Token","tags":["Auth"]}},"/api/v1/auth/profile":{"get":{"operationId":"AuthController_getProfile","parameters":[],"responses":{"200":{"description":"Datos del usuario."},"401":{"description":"No autorizado."}},"security":[{"bearer":[]}],"summary":"Perfil de Usuario","tags":["Auth"]}},"/api/v1/auth/recover-password":{"post":{"operationId":"AuthController_recoverPassword","parameters":[],"responses":{"200":{"description":"Correo enviado."},"400":{"description":"Correo no encontrado."}},"summary":"Recuperar Clave","tags":["Auth"]}},"/api/v1/auth/reset-password":{"patch":{"operationId":"AuthController_resetPassword","parameters":[],"responses":{"200":{"description":"Contraseña cambiada."},"400":{"description":"Token inválido."}},"summary":"Restablecer Clave","tags":["Auth"]}},"/api/v1/users":{"get":{"operationId":"UsersController_findAll","parameters":[{"name":"role","required":true,"in":"query","schema":{"type":"string"}}],"responses":{"200":{"description":"Lista de usuarios."}},"security":[{"bearer":[]}],"summary":"Listar Usuarios","tags":["Users"]},"post":{"operationId":"UsersController_create","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateUserDto"}}}},"responses":{"201":{"description":"Usuario creado."},"400":{"description":"Datos inválidos."}},"summary":"Crear Usuario (Registro)","tags":["Users"]}},"/api/v1/users/drivers/available":{"get":{"operationId":"UsersController_findAvailableDrivers","parameters":[],"responses":{"200":{"description":"Lista de choferes disponibles."}},"summary":"Choferes Disponibles","tags":["Users"]}},"/api/v1/users/{id}":{"patch":{"operationId":"UsersController_update","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Usuario actualizado."},"404":{"description":"Usuario no encontrado."}},"summary":"Editar Usuario","tags":["Users"]}},"/api/v1/vehicles/stats":{"get":{"operationId":"VehiclesController_getStats","parameters":[],"responses":{"200":{"description":"Estadísticas de la flota."}},"summary":"KPIs de Vehículos","tags":["Vehicles"]}},"/api/v1/vehicles":{"get":{"operationId":"VehiclesController_findAll","parameters":[{"name":"page","required":true,"in":"query","schema":{"type":"number"}},{"name":"limit","required":true,"in":"query","schema":{"type":"number"}}],"responses":{"200":{"description":"Lista de vehículos paginada."}},"summary":"Listar Flota","tags":["Vehicles"]},"post":{"operationId":"VehiclesController_create","parameters":[],"responses":{"201":{"description":"Vehículo creado."},"400":{"description":"Datos inválidos."}},"summary":"Crear Vehículo (Admin)","tags":["Vehicles"]}},"/api/v1/vehicles/available":{"get":{"operationId":"VehiclesController_findAvailable","parameters":[],"responses":{"200":{"description":"Lista de vehículos disponibles."}},"summary":"Vehículos Disponibles","tags":["Vehicles"]}},"/api/v1/vehicles/{id}":{"get":{"operationId":"VehiclesController_findOne","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Detalle del vehículo."},"404":{"description":"Vehículo no encontrado."}},"summary":"Detalle Vehículo","tags":["Vehicles"]},"patch":{"operationId":"VehiclesController_update","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Vehículo actualizado."},"404":{"description":"Vehículo no encontrado."}},"summary":"Editar Vehículo","tags":["Vehicles"]},"delete":{"operationId":"VehiclesController_remove","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Vehículo eliminado."},"404":{"description":"Vehículo no encontrado."}},"summary":"Eliminar (Soft Delete)","tags":["Vehicles"]}},"/api/v1/companies":{"get":{"operationId":"CompaniesController_findAll","parameters":[],"responses":{"200":{"description":"Lista de clientes."}},"summary":"Listar Clientes","tags":["Companies"]},"post":{"operationId":"CompaniesController_create","parameters":[],"responses":{"201":{"description":"Cliente creado."},"400":{"description":"Datos inválidos."}},"summary":"Crear Cliente","tags":["Companies"]}},"/api/v1/companies/{id}/stats":{"get":{"operationId":"CompaniesController_getStats","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Estadísticas del cliente."},"404":{"description":"Cliente no encontrado."}},"summary":"Estadísticas Cliente","tags":["Companies"]}},"/api/v1/service-requests":{"post":{"operationId":"ServiceRequestsController_create","parameters":[],"responses":{"201":{"description":"Solicitud creada."},"400":{"description":"Datos inválidos."}},"summary":"Crear Solicitud","tags":["ServiceRequests"]},"get":{"operationId":"ServiceRequestsController_findAll","parameters":[],"responses":{"200":{"description":"Lista de solicitudes."}},"summary":"Listar Solicitudes","tags":["ServiceRequests"]}},"/api/v1/service-requests/{id}":{"get":{"operationId":"ServiceRequestsController_findOne","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Detalle de la solicitud."},"404":{"description":"Solicitud no encontrada."}},"summary":"Detalle Solicitud","tags":["ServiceRequests"]}},"/api/v1/service-requests/{id}/assign":{"patch":{"operationId":"ServiceRequestsController_assign","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Recurso asignado."},"400":{"description":"Asignación inválida."}},"summary":"Asignar Recurso","tags":["ServiceRequests"]}},"/api/v1/service-requests/{id}/cancel":{"patch":{"operationId":"ServiceRequestsController_cancel","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Solicitud cancelada."},"404":{"description":"Solicitud no encontrada."}},"summary":"Cancelar Solicitud","tags":["ServiceRequests"]}},"/api/v1/trips/my-trips":{"get":{"operationId":"TripsController_getMyTrips","parameters":[],"responses":{"200":{"description":"Lista de viajes del chofer."}},"summary":"Mis Viajes","tags":["Trips"]}},"/api/v1/trips/{id}/start":{"patch":{"operationId":"TripsController_startTrip","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Viaje iniciado."},"404":{"description":"Viaje no encontrado."}},"summary":"Iniciar Ruta","tags":["Trips"]}},"/api/v1/trips/{id}/finish":{"patch":{"operationId":"TripsController_finishTrip","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"200":{"description":"Viaje finalizado."},"404":{"description":"Viaje no encontrado."}},"summary":"Finalizar Ruta","tags":["Trips"]}},"/api/v1/trips/{id}/evidence":{"post":{"operationId":"TripsController_uploadEvidence","parameters":[{"name":"id","required":true,"in":"path","schema":{"type":"string"}}],"responses":{"201":{"description":"Evidencia subida."},"400":{"description":"Error al subir evidencia."}},"summary":"Subir Evidencia","tags":["Trips"]}},"/api/v1/reports/billing":{"get":{"operationId":"ReportsController_getBillingReport","parameters":[],"responses":{"200":{"description":"Reporte de facturación."}},"summary":"Reporte Facturación","tags":["Reports"]}},"/api/v1/reports/dashboard":{"get":{"operationId":"ReportsController_getDashboardStats","parameters":[],"responses":{"200":{"description":"Datos del dashboard."}},"summary":"KPIs Operativos","tags":["Reports"]}},"/api/v1/health":{"get":{"operationId":"HealthController_check","parameters":[],"responses":{"200":{"description":""}},"summary":"Check API, Database, and Redis health","tags":["Health"]}},"/api/v1/payments/webpay/init":{"post":{"operationId":"PaymentsController_initWebpay","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/InitWebpayDto"}}}},"responses":{"201":{"description":"Transaccion iniciada correctamente","content":{"application/json":{"schema":{"example":{"token":"xx","url":"xx"}}}}}},"summary":"Iniciar una transaccion de pago con Webpay Plus","tags":["Payments"]}},"/api/v1/payments/test-init":{"post":{"operationId":"PaymentsController_initManualTransaction","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TestInitWebpayDto"}}}},"responses":{"201":{"description":""}},"summary":"DEBUG: Iniciar transaccion manual sin BD","tags":["Payments"]}},"/api/v1/payments/webpay/commit":{"post":{"operationId":"PaymentsController_commitWebpay","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CommitWebpayDto"}}}},"responses":{"201":{"description":""}},"summary":"Confirmar transaccion de Webpay (Usado por el Frontend)","tags":["Payments"]}},"/api/v1/payments/webpay/status/{token}":{"get":{"operationId":"PaymentsController_checkStatus","parameters":[{"name":"token","required":true,"in":"path","description":"Token Webpay (token_ws)","schema":{"type":"string"}}],"responses":{"200":{"description":""}},"summary":"Consultar estado REAL de una transaccion en Transbank y sincronizar BD","tags":["Payments"]}},"/api/v1/payments/webpay/refund":{"post":{"operationId":"PaymentsController_refundTransaction","parameters":[],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefundWebpayDto"}}}},"responses":{"201":{"description":""}},"summary":"Anular/Reembolsar una transaccion (Admin)","tags":["Payments"]}},"/api/v1/payments/webpay/reconcile":{"post":{"operationId":"PaymentsController_reconcile","parameters":[],"responses":{"201":{"description":""}},"summary":"Conciliar transacciones pendientes antiguas (Cron job)","tags":["Payments"]}}},"info":{"title":"Servicios El Loa API","description":"API para gestión de transporte corporativo y fleet management","version":"1.0","contact":{}},"tags":[],"servers":[],"components":{"securitySchemes":{"bearer":{"scheme":"bearer","bearerFormat":"JWT","type":"http"}},"schemas":{"RegisterDto":{"type":"object","properties":{"email":{"type":"string","example":"nuevo@usuario.cl"},"password":{"type":"string","example":"ContraseñaSegura123","minLength":6},"fullName":{"type":"string","example":"Juan Nuevo"},"phone":{"type":"string","example":"+56912345678"}},"required":["email","password","fullName"]},"LoginDto":{"type":"object","properties":{"email":{"type":"string","example":"admin@elloa.cl"},"password":{"type":"string","example":"Secret123!"}},"required":["email","password"]},"RefreshTokenDto":{"type":"object","properties":{"refreshToken":{"type":"string","example":"your-refresh-token"}},"required":["refreshToken"]},"CreateUserDto":{"type":"object","properties":{"email":{"type":"string","example":"juan@elloa.cl"},"password":{"type":"string","example":"Secret123!","minLength":6},"fullName":{"type":"string","example":"Juan Perez"},"role":{"type":"string","enum":["ADMIN","CHOFER","CLIENTE"],"default":"CLIENTE"},"phone":{"type":"string","example":"+56912345678"},"companyId":{"type":"string","example":"uuid-company"}},"required":["email","password","fullName","role"]},"InitWebpayDto":{"type":"object","properties":{"tripId":{"type":"string","description":"El ID único del viaje (Trip) que se desea pagar","example":"123e4567-e89b-12d3-a456-426614174000"}},"required":["tripId"]},"TestInitWebpayDto":{"type":"object","properties":{"amount":{"type":"number","description":"Monto a probar","example":1000},"productName":{"type":"string","description":"Nombre del producto (solo para referencia)","example":"Prueba de Humo"},"buyOrder":{"type":"string","description":"Orden de compra (opcional)","example":"TEST-123456"}},"required":["amount","productName"]},"CommitWebpayDto":{"type":"object","properties":{"token_ws":{"type":"string","description":"El token recibido desde Webpay (token_ws)","example":"01ab2bf123..."}},"required":["token_ws"]},"RefundWebpayDto":{"type":"object","properties":{"tripId":{"type":"string","description":"El ID único del viaje (Trip) cuya transacción se desea anular","example":"123e4567-e89b-12d3-a456-426614174000"},"amount":{"type":"number","description":"Monto a reembolsar. Si se omite, se reembolsa el total.","example":1000}},"required":["tripId"]}}}}